<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/now-ui-kit.css">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,600,700,800,900&display=swap" rel="stylesheet">
    <title>AI or Not</title>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-transparent">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <img src="assets/menuIcon.svg" width="20px" height="20px" style="max-width: none !important;">
    </button>
    <img src="images/logoMBH.png" width="60" height="60">
    <div class="collapse navbar-collapse" id="navbarSupportedContent" style="margin-left: 20px !important">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="file:///C:/Users/HP/M%C3%A1y%20t%C3%ADnh/WebAIGeneratedFaceDetection/src/index.html">Home <span class="sr-only">(current)</span></a>
            </li>
        </ul>
    </div>
</nav>

<div class="container">
    <div id="left" class="left">
      <h1 class="display-5 title">AI or Not</h1>
      <p class="subtitle">Determine whether an image has been<br />generated by artificial intelligence or a human</p>
    </div>

    <div class="loader-container" id="loadingcontainer">
        <div class="loader"></div>
        <div class="processing-text">Processing...</div>
    </div>

    <div id="right" class="right2">
        <div class="highlight" onclick="uploadImage()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" onmouseover="highlightBorder(true)" onmouseout="highlightBorder(false)">
            <img src="images/icon-drag-and-drop.png" class="icon_drag_drop" width="60" height="60">
            <h1 class="display-5 title_right">Drag and drop</h1>
            <div class="subtitle_right_mid">or <strong class="text-color">upload</strong> your image</div>
            <p class="subtitle_right">We support jpeg, png, webp, gif, tiff, bmp.<br />10Mb of maximum size.</p>
            <input type="file" id="fileInput" name="file" style="display: none" accept="image/*" onchange="handleFileSelect(event)">
        </div>
        <div id="hero-home_drop-zone-divider" class="hero-home_drop-zone-divider">
            <div class="hero-home_drop-zone-divider-line"></div>
            <div class="hero-home_drop-zone-divider-text">or</div>
            <div class="hero-home_drop-zone-divider-line"></div>
        </div>
        <div class="">
            <input type="text" class="textField" id="urlInput" placeholder=" Paste image URL here">
            <input type="button" id="aiornotbtn" value="AI or Not?" class="btn login-btn btn-outline-accent my-2 my- sm-0" style="font-size: 16px !important;font-family: poppins !important;" onclick="sendUrl()">
        </div>
    </div>
</div>

<div class="page_end">
    <div class="footer">
        <div class="bot-footer">
            <img src="images/logoMBH.png" width="150"><br />
            Copyright © [JACK97] - 2023
        </div><br/>
        <div class="nouridio">website designed by <a href="https://cdn.tuoitre.vn/471584752817336320/2023/8/13/f3xiqfpw4aeo-vo-1691881627442514206495-232-0-1306-1718-crop-1691881638057571163265.jpg"> Nobody</a></div>
    </div>
</div>

<script>
    // upload image tu thiet bi len
    function uploadImage() {
      document.getElementById('fileInput').click();
    }

    // đổi màu viền khi di chuột vào container
    function highlightBorder(on) {
      const div = document.querySelector('.highlight');
      if (on) {
        div.style.borderColor = '#e3dede'; // Màu viền khi di chuột vào
      } else {
        div.style.borderColor = '#ffffff33'; // Màu viền mặc định
      }
    }

    // xử lý kéo ảnh
    function handleDragOver(event) {
      event.preventDefault();
    }

    // xử lý thả ảnh
    function handleDrop(event) {
        event.preventDefault();
        const files = event.dataTransfer.files;
        console.log('ok1');
        handleFile(files);
    }

    //upload ảnh kéo thả lên server
    function handleFile(files) {
        const reader = new FileReader();
        reader.onload = function (e) {
            const imageDataUrl = e.target.result;
            localStorage.setItem('image', imageDataUrl);
        };
        reader.readAsDataURL(files[0]);
        console.log('ok2');
        handleFiles_drag(files);
    }

    async function handleFiles_drag(files) {
        const file = files[0];
        if (file) {
            const formData = new FormData();
            formData.append('file', file);
            console.log("loading");  

            const left = document.getElementById('left');
            left.style.visibility = 'hidden';

            const right = document.getElementById('right');
            right.style.visibility = 'hidden';

            const loadingContainer = document.getElementById('loadingcontainer');
            loadingContainer.style.visibility = 'visible';

            try {
                const response = await fetch('http://127.0.0.1:8000/upload_and_process', {
                    method: 'POST',
                    body: formData,
                });
                const data = await response.json();
                localStorage.setItem('result', JSON.stringify(data.result));
                console.log(data.result);
                window.location.href = 'result.html';
            } catch (error) {
                console.error('err:', error);
            }
        } else {
            alert('Vui lòng chọn ảnh.');
        } 
    }

    function handleFileSelect(event) {
        const files = event.target.files;
        const reader = new FileReader();

        reader.onload = function (e) {
            const base64Image = e.target.result;

            const img = new Image();
            img.src = base64Image;
            console.log(base64Image);
            img.onload = function () {
                const width = img.width;
                const height = img.height;

                localStorage.setItem('image', base64Image);
                localStorage.setItem('width', width);
                localStorage.setItem('height', height);

                window.location.href = 'cropimage.html';
            };
        };
        reader.readAsDataURL(files[0]);
    }

    async function sendUrl() {
        const urlInput = document.getElementById('urlInput').value;
        localStorage.setItem('url_image', urlInput);
        console.log(urlInput);
        window.location.href = 'cropimage.html';
    }


</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="js/now-ui-kit.min.js"></script>
</body>
</html>
